<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IAH - Análise Textual</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Roboto+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <style>
    /* --- TEMA "DEEP FREEZE" --- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }

    body {
      /* Gradiente Frio e Profundo */
      background: linear-gradient(135deg, #029104 0%, #8c03e0 100%);
      color: #e0f7fa;
      /* Texto quase branco (gelo) */
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      user-select: none;
    }

    .hidden {
      display: none !important;
    }

    .screen {
      background: rgba(255, 255, 255, 0.05);
      /* Vidro escuro */
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 16px;
      width: 100%;
      max-width: 850px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h2 {
      color: #4facfe;
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    p {
      color: #b0bec5;
    }

    /* Botões Neon */
    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      background: linear-gradient(90deg, #00c6ff, #0072ff);
      color: white;
      transition: 0.3s;
      box-shadow: 0 4px 15px rgba(0, 198, 255, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 198, 255, 0.5);
    }

    .btn:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Inputs Estilizados */
    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
      color: #4facfe;
    }

    input,
    select {
      width: 100%;
      padding: 12px;
      border: 1px solid #2c3e50;
      border-radius: 8px;
      font-size: 15px;
      background-color: #0f2027;
      color: white;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #00c6ff;
    }

    /* Cartão de Texto (Onde lê) */
    .text-card {
      background-color: #f0f8ff;
      /* Azul Alice muito claro para leitura */
      padding: 25px;
      border-left: 5px solid #00c6ff;
      border-radius: 6px;
      font-family: 'Roboto Mono', monospace;
      /* Fonte técnica */
      font-size: 14px;
      line-height: 1.7;
      color: #1a2a3a;
      /* Texto escuro no papel claro */
      margin-bottom: 15px;
      max-height: 450px;
      overflow-y: auto;
      white-space: pre-wrap;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* Layout Comparativo */
    .media-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    .dual {
      flex-direction: row;
      align-items: stretch;
    }

    .dual .text-card {
      width: 50%;
      font-size: 12px;
      margin-bottom: 0;
    }

    /* Opções de Resposta */
    .radio-option {
      display: flex;
      align-items: center;
      padding: 12px;
      margin-bottom: 8px;
      border: 1px solid #2c3e50;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
    }

    .radio-option:hover {
      background: rgba(0, 198, 255, 0.1);
      border-color: #00c6ff;
    }

    .radio-option input {
      width: auto;
      margin-right: 12px;
      accent-color: #00c6ff;
      transform: scale(1.2);
    }

    /* Consentimento Box */
    .terms-box {
      max-height: 200px;
      overflow-y: auto;
      background: #0f2027;
      border: 1px solid #2c3e50;
      padding: 15px;
      border-radius: 8px;
      font-size: 13px;
      text-align: justify;
      color: #ccc;
    }

    @media (max-width: 600px) {
      .dual {
        flex-direction: column;
      }

      .dual .text-card {
        width: 100%;
      }
    }

    .confidence-box {
      background: #f0f8ff;
      padding: 15px;
      border: 1px solid #00c6ff;
      border-radius: 8px;
      margin-top: 10px;
      text-align: center;
      color: #1a2a3a;
    }

    .confidence-box input[type="range"] {
      width: 80%;
      accent-color: #00c6ff;
    }
  </style>
</head>

<body>

  <div id="screen-consent" class="screen">
    <h2>Pesquisa: IA vs Humano</h2>
    <div class="terms-box">
      <p>Você está convidado para o experimento <strong>"Detecção de Autoria Textual"</strong>.</p>
      <p><strong>Missão:</strong> Ler trechos de textos e identificar se foram escritos por uma pessoa ou gerados por
        IA.</p>
      <p><strong>Privacidade:</strong> Dados 100% anônimos para fins acadêmicos.</p>
      <p>Ao continuar, você aceita participar.</p>
    </div>
    <button class="btn" onclick="goRegistration()">Aceitar Missão</button>
  </div>

  <div id="screen-register" class="screen hidden">
    <h2>Perfil do Analista</h2>
    <form id="form-register">
      <div class="form-group"><label>Idade:</label><input type="number" id="reg-idade" required min="10" max="100">
      </div>
      <div class="form-group"><label>Gênero:</label>
        <select id="reg-genero" required>
          <option value="">Selecione...</option>
          <option value="Feminino">Feminino</option>
          <option value="Masculino">Masculino</option>
          <option value="Outro">Outro</option>
        </select>
      </div>
      <div class="form-group"><label>Escolaridade:</label>
        <select id="reg-escolaridade" required>
          <option value="">Selecione...</option>
          <option value="Fundamental">Fundamental</option>
          <option value="Médio">Médio</option>
          <option value="Superior">Superior</option>
        </select>
      </div>
      <div class="form-group"><label>Experiência com IA:</label>
        <select id="reg-ia" required>
          <option value="">Selecione...</option>
          <option value="Nenhum">Nenhuma</option>
          <option value="Básico">Básica</option>
          <option value="Avançado">Avançada</option>
        </select>
      </div>
      <button type="submit" class="btn">Iniciar Análise</button>
    </form>
  </div>

  <div id="screen-intro" class="screen hidden">
    <h2>ID Gerado: <span id="user-code" style="color:#00c6ff">...</span></h2>
    <p style="text-align:center">Prepare-se. Leia com atenção aos detalhes, coerência e "alucinações".</p>
    <button class="btn" onclick="startQuiz()">Começar</button>
  </div>

  <div id="screen-quiz" class="screen hidden">
    <div style="display:flex; justify-content:space-between; font-size:14px; margin-bottom:10px; color:#4facfe;">
      <span id="progress-text">Texto 1/10</span>
      <span>Tempo: <span id="timer-count" style="font-weight:bold; color:#fff;">0</span>s</span>
    </div>

    <p id="quiz-question"
      style="font-weight:bold; text-align:center; margin-bottom:15px; font-size:1.1em; color:#e0f7fa;"></p>

    <div id="media-wrapper" class="media-container"></div>

    <form id="form-quiz">
      <div id="dynamic-inputs"></div>
      <div class="form-group" id="justificativa-container"
        style="margin-top:20px; border-top:1px solid #2c3e50; padding-top:15px;">
        <label id="label-justificativa">Observação (Opcional):</label>
        <input type="text" id="quiz-justificativa" placeholder="O que denunciou a autoria?">
      </div>
      <button type="submit" class="btn">Próximo</button>
    </form>
  </div>

  <div id="screen-end" class="screen hidden">
    <h2>Análise Concluída</h2>
    <div style="text-align:center; margin:30px 0;">
      <span style="font-size:18px; color:#b0bec5;">Precisão:</span><br>
      <span id="final-score" style="font-size:50px; font-weight:bold; color:#00c6ff;">0</span>
    </div>
    <p style="text-align:center;">Dados computados.</p>
    <button class="btn" onclick="location.reload()">Reiniciar</button>
  </div>

  <script>
    // ESTADO
    const state = { id_participante: null, codigo: '', questions: [], currentIdx: 0, answers: [], logs: [], startTime: 0, timerInterval: null, score: 0 };

    function show(id) { document.querySelectorAll('.screen').forEach(el => el.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    function goRegistration() { show('screen-register'); log('view_registration'); }

    // --- FUNÇÃO ESPIÃO ---
    function log(type, details = {}) {
      state.logs.push({ timestamp: Date.now(), event_type: type, details: { ...details, q: state.currentIdx } });
    }

    // REGISTRO
    document.getElementById('form-register').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = e.target.querySelector('button'); btn.disabled = true; btn.innerText = "Salvando...";
      const data = { idade: document.getElementById('reg-idade').value, genero: document.getElementById('reg-genero').value, escolaridade: document.getElementById('reg-escolaridade').value, nivel_ia: document.getElementById('reg-ia').value };
      try {
        const res = await fetch('IAHtextregistro.php', { method: 'POST', body: JSON.stringify(data) });
        const json = await res.json();
        if (json.success) {
          state.id_participante = json.id_participante; state.codigo = json.codigo_gerado;
          document.getElementById('user-code').innerText = state.codigo;
          show('screen-intro');
          log('registration_success');
        } else { alert(json.error); btn.disabled = false; }
      } catch (err) { alert('Erro conexão'); btn.disabled = false; }
    });

    // INICIAR
    async function startQuiz() {
      try {
        const res = await fetch('IAHtextbuscar.php');
        state.questions = await res.json();
        if (state.questions.length === 0) throw new Error("Sem textos.");
        log('quiz_start'); show('screen-quiz'); loadQuestion();
      } catch (e) { alert(e.message); }
    }

    // CARREGAR PERGUNTA (Com Espião de Texto)
    function loadQuestion() {
      const q = state.questions[state.currentIdx];
      const inputsDiv = document.getElementById('dynamic-inputs');
      const justInput = document.getElementById('quiz-justificativa');
      const mediaDiv = document.getElementById('media-wrapper');

      document.getElementById('progress-text').innerText = `Texto ${state.currentIdx + 1}/${state.questions.length}`;
      document.getElementById('quiz-question').innerText = q.texto;

      mediaDiv.className = (q.modo === 'comparativo') ? 'media-container dual' : 'media-container';
      mediaDiv.innerHTML = '';

      q.conteudos.forEach((texto) => {
        const card = document.createElement('div');
        card.className = 'text-card';
        card.innerText = texto;

        // ESPIÃO: Detecta se selecionou texto para copiar
        card.onmouseup = () => {
          const sel = window.getSelection().toString();
          if (sel.length > 0) log('text_selected', { length: sel.length });
        };

        mediaDiv.appendChild(card);
      });

      inputsDiv.innerHTML = ''; justInput.value = ''; justInput.required = false; document.getElementById('label-justificativa').innerText = 'Observação (Opcional):';
      let html = '';

      if (q.modo === 'padrao') {
        html += `<label class="radio-option"><input type="radio" name="choice" value="ia_certeza" required> É IA (Certeza)</label> <label class="radio-option"><input type="radio" name="choice" value="ia_duvida"> É IA (Dúvida)</label> <label class="radio-option"><input type="radio" name="choice" value="humano_certeza"> É Humano (Certeza)</label> <label class="radio-option"><input type="radio" name="choice" value="humano_duvida"> É Humano (Dúvida)</label>`;
      } else if (q.modo === 'comparativo') {
        html += `<label class="radio-option"><input type="radio" name="choice" value="texto_a" required> A (Esq) é IA</label> <label class="radio-option"><input type="radio" name="choice" value="texto_b"> B (Dir) é IA</label>`;
      } else if (q.modo === 'analise') {
        html += `<label class="radio-option"><input type="radio" name="choice" value="concordo" required> Concordo</label> <label class="radio-option"><input type="radio" name="choice" value="discordo"> Discordo</label>`;
      } else if (q.modo === 'aberta') {
        justInput.required = true; document.getElementById('label-justificativa').innerText = 'Sua Resposta (Obrigatória):'; html += `<input type="hidden" name="choice" value="texto_livre">`;
      }
      inputsDiv.innerHTML = html;

      if (state.timerInterval) clearInterval(state.timerInterval);
      state.startTime = Date.now();
      document.getElementById('timer-count').innerText = "0";
      state.timerInterval = setInterval(() => { document.getElementById('timer-count').innerText = Math.floor((Date.now() - state.startTime) / 1000); }, 1000);

      log('view_question', { id: q.item_id, modo: q.modo });
    }

    // RESPONDER
    document.getElementById('form-quiz').addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const q = state.questions[state.currentIdx];
      const choice = formData.get('choice');

      let isCorrect = false;
      if (q.modo === 'padrao') isCorrect = choice.startsWith(q.gabarito);
      else if (q.modo === 'comparativo') isCorrect = (choice === q.gabarito);
      else isCorrect = true;

      if (isCorrect) state.score++;

      state.answers.push({
        id: q.item_id, pergunta: q.texto, choice: choice, isCorrect: isCorrect,
        timeTaken: (Date.now() - state.startTime) / 1000,
        justificativa: document.getElementById('quiz-justificativa').value
      });

      log('answer_submit');
      state.currentIdx++;
      if (state.currentIdx < state.questions.length) loadQuestion(); else finishQuiz();
    });

    async function finishQuiz() {
      show('screen-end');
      document.getElementById('final-score').innerText = `${state.score} / ${state.questions.length}`;
      await fetch('IAHtextsalvar.php', { method: 'POST', body: JSON.stringify({ id_participante: state.id_participante, respostas: state.answers, logs: state.logs }) });
    }

    // --- ESPIÕES GLOBAIS ---
    document.addEventListener("visibilitychange", () => log(document.visibilityState === 'hidden' ? 'tab_hidden' : 'tab_visible'));
    document.addEventListener("click", (e) => { if (!e.target.closest('button')) log('screen_click', { x: e.clientX, y: e.clientY }); });
    document.addEventListener("copy", () => log('text_copied')); // Flagrante de cola!
  </script>
  </script>
</body>

</html>
